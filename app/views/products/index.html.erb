<div class="wrapper">
    <div class="content">
        <h1>Stripe Checkout</h1>
        <p>Stripe Checkout is an embeded payment form used in
            custom websites or applications. The client- and server-side code
            builds a checkout form to complete a card payment.
            <%= link_to "view integration guide", "https://stripe.com/docs/payments/integration-builder", :target => "_blank" %>
        </p>
        <button id="checkout-btn">Redirect to Checkout</button>
    </div>
</div>

<script>
    const stripe = Stripe('<%= Rails.configuration.stripe[:publishable_key] %>');
    const checkoutButton = document.getElementById('checkout-btn');

    checkoutButton.addEventListener('click', function () {
        stripe.redirectToCheckout({
            sessionId: '<%= @session %>' // Stripe session id required for redirect
        }).then((result) => {
            if (result.error) console.log(result.error.message)
        });
    });
</script>